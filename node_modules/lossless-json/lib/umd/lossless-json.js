!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).LosslessJSON={})}(this,(function(t){"use strict";function e(t){return n.test(t)}const n=/^-?[0-9]+$/;function r(t){return o.test(t)}const o=/^-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?$/;function i(t,n){const r=Number.parseFloat(t),o=String(r);if(t===o)return!0;const i=s(t),u=s(o);if(i===u)return!0;if(!0===n?.approx){if(u>=14&&!e(t))return!0}return!1}let u=function(t){return t.underflow="underflow",t.overflow="overflow",t.truncate_integer="truncate_integer",t.truncate_float="truncate_float",t}({});function c(t){if(i(t,{approx:!1}))return;if(e(t))return u.truncate_integer;const n=Number.parseFloat(t);return Number.isFinite(n)?0===n?u.underflow:u.truncate_float:u.overflow}function a(t){const e=t.match(/^(-?)(\d+\.?\d*)([eE]([+-]?\d+))?$/);if(!e)throw new SyntaxError(`Invalid number: ${t}`);const n=e[1],r=e[2];let o=void 0!==e[4]?Number.parseInt(e[4]):0;const i=r.indexOf(".");o+=-1!==i?i-1:r.length-1;const u=r.replace(".","").replace(/^0*/,(t=>(o-=t.length,""))).replace(/0*$/,"");return u.length>0?{sign:n,digits:u,exponent:o}:{sign:n,digits:"0",exponent:o+1}}function f(t,e){if(t===e)return 0;const n=a(t),r=a(e),o="-"===n.sign?-1:1;return n.sign!==r.sign?"0"===n.digits&&"0"===r.digits?0:o:n.exponent!==r.exponent?n.exponent>r.exponent?o:n.exponent<r.exponent?-o:0:n.digits>r.digits?o:n.digits<r.digits?-o:0}function s(t){let e=0;for("-"===t[0]&&e++;"0"===t[e]||"."===t[e];)e++;let n=t.lastIndexOf("e");for(-1===n&&(n=t.lastIndexOf("E")),-1===n&&(n=t.length);"0"===t[n-1]||"."===t[n-1];)n--;let r=n>=e?n-e:0;const o=t.indexOf(".",e);return-1!==o&&o<n&&r--,r}class l{isLosslessNumber=!0;constructor(t){if(!r(t))throw new Error(`Invalid number (value: "${t}")`);this.value=t}valueOf(){const t=c(this.value);if(void 0===t||t===u.truncate_float)return Number.parseFloat(this.value);if(e(this.value))return BigInt(this.value);throw new Error(`Cannot safely convert to number: the value '${this.value}' would ${t} and become ${Number.parseFloat(this.value)}`)}toString(){return this.value}}function d(t){return t&&"object"==typeof t&&t.isLosslessNumber||!1}function h(t){return new l(t)}function p(t,e,n,r){return Array.isArray(n)?r.call(t,e,function(t,e){for(let n=0;n<t.length;n++)t[n]=p(t,String(n),t[n],e);return t}(n,r)):n&&"object"==typeof n&&!d(n)?r.call(t,e,function(t,e){for(const n of Object.keys(t)){const r=p(t,n,t[n],e);void 0!==r?t[n]=r:delete t[n]}return t}(n,r)):r.call(t,e,n)}function y(t){return t>=L&&t<=F||t>=T&&t<=P||t>=R&&t<=Z}function g(t){return t>=L&&t<=F}function b(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e))return t.length===e.length&&t.every(((t,n)=>b(t,e[n])));if(w(t)&&w(e)){return[...new Set([...Object.keys(t),...Object.keys(e)])].every((n=>b(t[n],e[n])))}return!1}function w(t){return"object"==typeof t&&null!==t}const m={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},v=92,x=123,A=125,$=91,N=93,S=32,C=10,E=9,O=13,I=34,j=43,k=45,L=48,_=49,F=57,J=44,B=46,D=58,T=65,R=97,Q=69,U=101,P=70,Z=102;const q=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z$/;t.LosslessNumber=l,t.UnsafeNumberReason=u,t.compareLosslessNumber=function(t,e){return f(t.value,e.value)},t.compareNumber=f,t.config=function(t){throw new Error("config is deprecated, support for circularRefs is removed from the library. If you encounter circular references in your data structures, please rethink your datastructures: better prevent circular references in the first place.")},t.getUnsafeNumberReason=c,t.isInteger=e,t.isLosslessNumber=d,t.isNumber=r,t.isSafeNumber=i,t.parse=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h,r=0;const o=c();return function(t){if(void 0===t)throw new SyntaxError(`JSON value expected ${K()}`)}(o),function(){if(r<t.length)throw new SyntaxError(`Expected end of input ${K()}`)}(),e?function(t,e){return p({"":t},"",t,e)}(o,e):o;function i(){if(t.charCodeAt(r)===x){r++,f();const e={};let n=!0;for(;r<t.length&&t.charCodeAt(r)!==A;){n?n=!1:(l(),f());const t=r,o=s();if(void 0===o)return void R();f(),d();const i=c();if(void 0===i)return void z();Object.prototype.hasOwnProperty.call(e,o)&&!b(i,e[o])&&P(o,t+1),e[o]=i}return t.charCodeAt(r)!==A&&function(){throw new SyntaxError(`Quoted object key or end of object '}' expected ${K()}`)}(),r++,e}}function u(){if(t.charCodeAt(r)===$){r++,f();const e=[];let n=!0;for(;r<t.length&&t.charCodeAt(r)!==N;){n?n=!1:l();const t=c();w(t),e.push(t)}return t.charCodeAt(r)!==N&&function(){throw new SyntaxError(`Array item or end of array ']' expected ${K()}`)}(),r++,e}}function c(){f();const e=s()??function(){const e=r;t.charCodeAt(r)===k&&(r++,T(e));if(t.charCodeAt(r)===L)r++;else if(o=t.charCodeAt(r),o>=_&&o<=F)for(r++;g(t.charCodeAt(r));)r++;var o;if(t.charCodeAt(r)===B)for(r++,T(e);g(t.charCodeAt(r));)r++;if(t.charCodeAt(r)===U||t.charCodeAt(r)===Q)for(r++,t.charCodeAt(r)!==k&&t.charCodeAt(r)!==j||r++,T(e);g(t.charCodeAt(r));)r++;if(r>e)return n(t.slice(e,r))}()??i()??u()??a("true",!0)??a("false",!1)??a("null",null);return f(),e}function a(e,n){if(t.slice(r,r+e.length)===e)return r+=e.length,n}function f(){for(;(e=t.charCodeAt(r))===S||e===C||e===E||e===O;)r++;var e}function s(){if(t.charCodeAt(r)===I){r++;let n="";for(;r<t.length&&t.charCodeAt(r)!==I;){if(t.charCodeAt(r)===v){const e=t[r+1],o=m[e];void 0!==o?(n+=o,r++):"u"===e?y(t.charCodeAt(r+2))&&y(t.charCodeAt(r+3))&&y(t.charCodeAt(r+4))&&y(t.charCodeAt(r+5))?(n+=String.fromCharCode(Number.parseInt(t.slice(r+2,r+6),16)),r+=5):G(r):q(r)}else(e=t.charCodeAt(r))>=32&&e<=1114111?n+=t[r]:Z(t[r]);r++}return function(){if(t.charCodeAt(r)!==I)throw new SyntaxError(`End of string '"' expected ${K()}`)}(),r++,n}var e}function l(){if(t.charCodeAt(r)!==J)throw new SyntaxError(`Comma ',' expected after value ${K()}`);r++}function d(){if(t.charCodeAt(r)!==D)throw new SyntaxError(`Colon ':' expected after property name ${K()}`);r++}function w(t){if(void 0===t)throw new SyntaxError(`Array item expected ${K()}`)}function T(e){if(!g(t.charCodeAt(r))){const n=t.slice(e,r);throw new SyntaxError(`Invalid number '${n}', expecting a digit ${K()}`)}}function R(){throw new SyntaxError(`Quoted object key expected ${K()}`)}function P(t,e){throw new SyntaxError(`Duplicate key '${t}' encountered at position ${e}`)}function Z(t){throw new SyntaxError(`Invalid character '${t}' ${H()}`)}function q(e){const n=t.slice(e,e+2);throw new SyntaxError(`Invalid escape character '${n}' ${H()}`)}function z(){throw new SyntaxError(`Object value expected after ':' ${H()}`)}function G(e){const n=t.slice(e,e+6);throw new SyntaxError(`Invalid unicode character '${n}' ${H()}`)}function H(){return`at position ${r}`}function K(){return`${r<t.length?`but got '${t[r]}'`:"but reached end of input"} ${H()}`}},t.parseLosslessNumber=h,t.parseNumberAndBigInt=function(t){return e(t)?BigInt(t):Number.parseFloat(t)},t.reviveDate=function(t,e){return"string"==typeof e&&q.test(e)?new Date(e):e},t.splitNumber=a,t.stringify=function t(e,n,o,i){const u=function(t){if("number"==typeof t)return" ".repeat(t);if("string"==typeof t&&""!==t)return t;return}(o);return c("function"==typeof n?n.call({"":e},"",e):e,"");function c(e,f){if(Array.isArray(i)){const t=i.find((t=>t.test(e)));if(t){const n=t.stringify(e);if("string"!=typeof n||!r(n))throw new Error(`Invalid JSON number: output of a number stringifier must be a string containing a JSON number (output: ${n})`);return n}}return"boolean"==typeof e||"number"==typeof e||"string"==typeof e||null===e||e instanceof Date||e instanceof Boolean||e instanceof Number||e instanceof String?JSON.stringify(e):e?.isLosslessNumber||"bigint"==typeof e?e.toString():Array.isArray(e)?function(t,e){if(0===t.length)return"[]";const r=u?e+u:void 0;let o=u?"[\n":"[";for(let e=0;e<t.length;e++){const i="function"==typeof n?n.call(t,String(e),t[e]):t[e];u&&(o+=r),o+=void 0!==i&&"function"!=typeof i?c(i,r):"null",e<t.length-1&&(o+=u?",\n":",")}return o+=u?`\n${e}]`:"]",o}(e,f):e&&"object"==typeof e?function(e,r){if("function"==typeof e.toJSON)return t(e.toJSON(),n,o,void 0);const i=Array.isArray(n)?n.map(String):Object.keys(e);if(0===i.length)return"{}";const f=u?r+u:void 0;let s=!0,l=u?"{\n":"{";for(const t of i){const r="function"==typeof n?n.call(e,t,e[t]):e[t];if(a(t,r)){s?s=!1:l+=u?",\n":",";const e=JSON.stringify(t);l+=u?`${f+e}: `:`${e}:`,l+=c(r,f)}}return l+=u?`\n${r}}`:"}",l}(e,f):void 0}function a(t,e){return void 0!==e&&"function"!=typeof e&&"symbol"!=typeof e}},t.toLosslessNumber=function(t){if(s(String(t))>15)throw new Error(`Invalid number: contains more than 15 digits and is most likely truncated and unsafe by itself (value: ${t})`);if(Number.isNaN(t))throw new Error("Invalid number: NaN");if(!Number.isFinite(t))throw new Error(`Invalid number: ${t}`);return new l(String(t))},t.toSafeNumberOrThrow=function(t,e){const n=Number.parseFloat(t),r=c(t);if(!0===e?.approx?r&&r!==u.truncate_float:r){const e=r?.replace(/_\w+$/,"");throw new Error(`Cannot safely convert to number: the value '${t}' would ${e} and become ${n}`)}return n}}));//# sourceMappingURL=lossless-json.js.map
