f2dd47df451bd6f2614bfbbf64b972f9
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useBackendFallback = useBackendFallback;
const react_1 = require("react");
const BACKEND_URL = 'http://localhost:5000'; // Change if deployed elsewhere
async function backendMove(grid, width, height, x, y, direction) {
    const res = await fetch(`${BACKEND_URL}/move`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ grid, width, height, x, y, direction }),
    });
    return (await res.json()).grid;
}
async function backendApplyFormula(grid, width, height, formula) {
    const res = await fetch(`${BACKEND_URL}/apply_formula`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ grid, width, height, formula }),
    });
    return (await res.json()).grid;
}
async function backendCheckCompletion(grid, target) {
    const res = await fetch(`${BACKEND_URL}/check_completion`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ grid, target }),
    });
    return (await res.json()).completed;
}
function useBackendFallback(connectWalletFn, onchainFns) {
    // onchainFns: { move, applyFormula, checkCompletion }
    const [useBackend, setUseBackend] = (0, react_1.useState)(false);
    // Try to connect wallet, fallback if fails
    const tryConnectWallet = (0, react_1.useCallback)(async () => {
        try {
            await connectWalletFn();
            setUseBackend(false);
            return true;
        }
        catch (e) {
            setUseBackend(true);
            return false;
        }
    }, [connectWalletFn]);
    // Move
    const move = (0, react_1.useCallback)(async (grid, width, height, x, y, direction) => {
        if (useBackend) {
            return backendMove(grid, width, height, x, y, direction);
        }
        else {
            return onchainFns.move(grid, width, height, x, y, direction);
        }
    }, [useBackend, onchainFns]);
    // Apply formula
    const applyFormula = (0, react_1.useCallback)(async (grid, width, height, formula) => {
        if (useBackend) {
            return backendApplyFormula(grid, width, height, formula);
        }
        else {
            return onchainFns.applyFormula(grid, width, height, formula);
        }
    }, [useBackend, onchainFns]);
    // Check completion
    const checkCompletion = (0, react_1.useCallback)(async (grid, target) => {
        if (useBackend) {
            return backendCheckCompletion(grid, target);
        }
        else {
            return onchainFns.checkCompletion(grid, target);
        }
    }, [useBackend, onchainFns]);
    return {
        useBackend,
        tryConnectWallet,
        move,
        applyFormula,
        checkCompletion,
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3NheWFudGFucGFsMTAwL0Rlc2t0b3AvTXVtdS0tb25jaGFpbi1wdXp6bGUtZ2FtZS9mcm9udGVuZC9zcmMvaG9va3MvdXNlQmFja2VuZEZhbGxiYWNrLnRzIiwibWFwcGluZ3MiOiI7O0FBdURBLGdEQThEQztBQXJIRCxpQ0FBOEM7QUFFOUMsTUFBTSxXQUFXLEdBQUcsdUJBQXVCLENBQUMsQ0FBQywrQkFBK0I7QUFXNUUsS0FBSyxVQUFVLFdBQVcsQ0FDeEIsSUFBVSxFQUNWLEtBQWEsRUFDYixNQUFjLEVBQ2QsQ0FBUyxFQUNULENBQVMsRUFDVCxTQUFpQjtJQUVqQixNQUFNLEdBQUcsR0FBRyxNQUFNLEtBQUssQ0FBQyxHQUFHLFdBQVcsT0FBTyxFQUFFO1FBQzdDLE1BQU0sRUFBRSxNQUFNO1FBQ2QsT0FBTyxFQUFFLEVBQUUsY0FBYyxFQUFFLGtCQUFrQixFQUFFO1FBQy9DLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsQ0FBQztLQUMvRCxDQUFDLENBQUM7SUFDSCxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUM7QUFDakMsQ0FBQztBQUVELEtBQUssVUFBVSxtQkFBbUIsQ0FDaEMsSUFBVSxFQUNWLEtBQWEsRUFDYixNQUFjLEVBQ2QsT0FBZ0I7SUFFaEIsTUFBTSxHQUFHLEdBQUcsTUFBTSxLQUFLLENBQUMsR0FBRyxXQUFXLGdCQUFnQixFQUFFO1FBQ3RELE1BQU0sRUFBRSxNQUFNO1FBQ2QsT0FBTyxFQUFFLEVBQUUsY0FBYyxFQUFFLGtCQUFrQixFQUFFO1FBQy9DLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLENBQUM7S0FDdkQsQ0FBQyxDQUFDO0lBQ0gsT0FBTyxDQUFDLE1BQU0sR0FBRyxD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QUNILENBQUMsRUFDRCxDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUMsQ0FDekIsQ0FBQztJQUVGLE9BQU87UUFDTCxVQUFVO1FBQ1YsZ0JBQWdCO1FBQ2hCLElBQUk7UUFDSixZQUFZO1FBQ1osZUFBZTtLQUNoQixDQUFDO0FBQ0osQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvc2F5YW50YW5wYWwxMDAvRGVza3RvcC9NdW11LS1vbmNoYWluLXB1enpsZS1nYW1lL2Zyb250ZW5kL3NyYy9ob29rcy91c2VCYWNrZW5kRmFsbGJhY2sudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlU3RhdGUsIHVzZUNhbGxiYWNrIH0gZnJvbSAncmVhY3QnO1xuXG5jb25zdCBCQUNLRU5EX1VSTCA9ICdodHRwOi8vbG9jYWxob3N0OjUwMDAnOyAvLyBDaGFuZ2UgaWYgZGVwbG95ZWQgZWxzZXdoZXJlXG5cbnR5cGUgR3JpZCA9IG51bWJlcltdW107XG50eXBlIEZvcm11bGEgPSB7IGlucHV0OiBudW1iZXI7IG91dHB1dDogbnVtYmVyIH07XG5cbnR5cGUgT25jaGFpbkZucyA9IHtcbiAgbW92ZTogKGdyaWQ6IEdyaWQsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLCB4OiBudW1iZXIsIHk6IG51bWJlciwgZGlyZWN0aW9uOiBudW1iZXIpID0+IFByb21pc2U8R3JpZD47XG4gIGFwcGx5Rm9ybXVsYTogKGdyaWQ6IEdyaWQsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLCBmb3JtdWxhOiBGb3JtdWxhKSA9PiBQcm9taXNlPEdyaWQ+O1xuICBjaGVja0NvbXBsZXRpb246IChncmlkOiBHcmlkLCB0YXJnZXQ6IEdyaWQpID0+IFByb21pc2U8Ym9vbGVhbj47XG59O1xuXG5hc3luYyBmdW5jdGlvbiBiYWNrZW5kTW92ZShcbiAgZ3JpZDogR3JpZCxcbiAgd2lkdGg6IG51bWJlcixcbiAgaGVpZ2h0OiBudW1iZXIsXG4gIHg6IG51bWJlcixcbiAgeTogbnVtYmVyLFxuICBkaXJlY3Rpb246IG51bWJlclxuKTogUHJvbWlzZTxHcmlkPiB7XG4gIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKGAke0JBQ0tFTkRfVVJMfS9tb3ZlYCwge1xuICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9LFxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgZ3JpZCwgd2lkdGgsIGhlaWdodCwgeCwgeSwgZGlyZWN0aW9uIH0pLFxuICB9KTtcbiAgcmV0dXJuIChhd2FpdCByZXMuanNvbigpKS5ncmlkO1xufVxuXG5hc3luYyBmdW5jdGlvbiBiYWNrZW5kQXBwbHlGb3JtdWxhKFxuICBncmlkOiBHcmlkLFxuICB3aWR0aDogbnVtYmVyLFxuICBoZWlnaHQ6IG51bWJlcixcbiAgZm9ybXVsYTogRm9ybXVsYVxuKTogUHJvbWlzZTxHcmlkPiB7XG4gIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKGAke0JBQ0tFTkRfVVJMfS9hcHBseV9mb3JtdWxhYCwge1xuICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9LFxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgZ3JpZCwgd2lkdGgsIGhlaWdodCwgZm9ybXVsYSB9KSxcbiAgfSk7XG4gIHJldHVybiAoYXdhaXQgcmVzLmpzb24oKSkuZ3JpZDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gYmFja2VuZENoZWNrQ29tcGxldGlvbihcbiAgZ3JpZDogR3JpZCxcbiAgdGFyZ2V0OiBHcmlkXG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goYCR7QkFDS0VORF9VUkx9L2NoZWNrX2NvbXBsZXRpb25gLCB7XG4gICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBncmlkLCB0YXJnZXQgfSksXG4gIH0pO1xuICByZXR1cm4gKGF3YWl0IHJlcy5qc29uKCkpLmNvbXBsZXRlZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVzZUJhY2tlbmRGYWxsYmFjayhcbiAgY29ubmVjdFdhbGxldEZuOiAoKSA9PiBQcm9taXNlPHZvaWQ+LFxuICBvbmNoYWluRm5zOiBPbmNoYWluRm5zXG4pIHtcbiAgLy8gb25jaGFpbkZuczogeyBtb3ZlLCBhcHBseUZvcm11bGEsIGNoZWNrQ29tcGxldGlvbiB9XG4gIGNvbnN0IFt1c2VCYWNrZW5kLCBzZXRVc2VCYWNrZW5kXSA9IHVzZVN0YXRlKGZhbHNlKTtcblxuICAvLyBUcnkgdG8gY29ubmVjdCB3YWxsZXQsIGZhbGxiYWNrIGlmIGZhaWxzXG4gIGNvbnN0IHRyeUNvbm5lY3RXYWxsZXQgPSB1c2VDYWxsYmFjayhhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGNvbm5lY3RXYWxsZXRGbigpO1xuICAgICAgc2V0VXNlQmFja2VuZChmYWxzZSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBzZXRVc2VCYWNrZW5kKHRydWUpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSwgW2Nvbm5lY3RXYWxsZXRGbl0pO1xuXG4gIC8vIE1vdmVcbiAgY29uc3QgbW92ZSA9IHVzZUNhbGxiYWNrKFxuICAgIGFzeW5jIChncmlkOiBHcmlkLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciwgeDogbnVtYmVyLCB5OiBudW1iZXIsIGRpcmVjdGlvbjogbnVtYmVyKSA9PiB7XG4gICAgICBpZiAodXNlQmFja2VuZCkge1xuICAgICAgICByZXR1cm4gYmFja2VuZE1vdmUoZ3JpZCwgd2lkdGgsIGhlaWdodCwgeCwgeSwgZGlyZWN0aW9uKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBvbmNoYWluRm5zLm1vdmUoZ3JpZCwgd2lkdGgsIGhlaWdodCwgeCwgeSwgZGlyZWN0aW9uKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFt1c2VCYWNrZW5kLCBvbmNoYWluRm5zXVxuICApO1xuXG4gIC8vIEFwcGx5IGZvcm11bGFcbiAgY29uc3QgYXBwbHlGb3JtdWxhID0gdXNlQ2FsbGJhY2soXG4gICAgYXN5bmMgKGdyaWQ6IEdyaWQsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLCBmb3JtdWxhOiBGb3JtdWxhKSA9PiB7XG4gICAgICBpZiAodXNlQmFja2VuZCkge1xuICAgICAgICByZXR1cm4gYmFja2VuZEFwcGx5Rm9ybXVsYShncmlkLCB3aWR0aCwgaGVpZ2h0LCBmb3JtdWxhKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBvbmNoYWluRm5zLmFwcGx5Rm9ybXVsYShncmlkLCB3aWR0aCwgaGVpZ2h0LCBmb3JtdWxhKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFt1c2VCYWNrZW5kLCBvbmNoYWluRm5zXVxuICApO1xuXG4gIC8vIENoZWNrIGNvbXBsZXRpb25cbiAgY29uc3QgY2hlY2tDb21wbGV0aW9uID0gdXNlQ2FsbGJhY2soXG4gICAgYXN5bmMgKGdyaWQ6IEdyaWQsIHRhcmdldDogR3JpZCkgPT4ge1xuICAgICAgaWYgKHVzZUJhY2tlbmQpIHtcbiAgICAgICAgcmV0dXJuIGJhY2tlbmRDaGVja0NvbXBsZXRpb24oZ3JpZCwgdGFyZ2V0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBvbmNoYWluRm5zLmNoZWNrQ29tcGxldGlvbihncmlkLCB0YXJnZXQpO1xuICAgICAgfVxuICAgIH0sXG4gICAgW3VzZUJhY2tlbmQsIG9uY2hhaW5GbnNdXG4gICk7XG5cbiAgcmV0dXJuIHtcbiAgICB1c2VCYWNrZW5kLFxuICAgIHRyeUNvbm5lY3RXYWxsZXQsXG4gICAgbW92ZSxcbiAgICBhcHBseUZvcm11bGEsXG4gICAgY2hlY2tDb21wbGV0aW9uLFxuICB9O1xufSAiXSwidmVyc2lvbiI6M30=